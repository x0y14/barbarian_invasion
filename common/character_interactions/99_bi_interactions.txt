dispatch_landless_looters_interaction = {
	interface_priority = 100
	common_interaction = yes
	category = interaction_category_hostile
	cooldown_against_recipient = { years = 2 }

	icon = request_mercenary
	desc = dispatch_landless_looters_interaction_desc

	is_shown = {
		# 無効化されていないこと
		NOT = { has_game_rule = barbarian_migration_landless_looters_never }
		
		scope:actor = {
			# is_ai = yes
			# テュルク系遊牧民
			has_government = tribal_government
			OR = {
				culture = { has_cultural_pillar = heritage_turkic }
				culture = { has_cultural_pillar = heritage_mongolic }
			}
			OR = {
				AND = {
					current_date >= 1066.1.1
					faith.religion = religion:islam_religion
				}
				faith = { has_doctrine_parameter = unreformed }
			}
			# 王国以上
			highest_held_title_tier >= tier_kingdom
			# 独立している
			is_independent_ruler = yes
			# クールダウン
			NOT = { has_character_flag = bi_dispatch_cooldown }
		}

		scope:recipient = {
			# 存在確認
			is_landed = yes
			exists = capital_province
			# 最近攻撃されていないこと
			NOT = { has_character_flag = bm_cb_protect }
			# 独立していること
			is_independent_ruler = yes
			# 部族じゃないこと
			NOT = { has_government = tribal_government }
		}

		NOT = { scope:actor = scope:recipient }
	}

	is_valid_showing_failures_only = {}

	cost = {
		gold = {
			value = 100
		}
	}

	on_accept = {
		custom_tooltip = {
			text = dispatch_landless_looters_interaction_tt
			scope:actor = {
				if = {
					limit = {
						NOT = { has_game_rule = barbarian_migration_landless_looters_apocalyptic }
					}
					add_character_flag = {
						flag = bi_dispatch_cooldown
						years = DISPATCH_LANDLESS_LOOTERS_COOLDOWN
					}
				}
				create_character = {
					template = bi_looter_template
					employer = scope:actor
					save_scope_as = bi_looter
				}
			}

			scope:recipient = {
				if = {
					limit = {
						NOT = { has_game_rule = barbarian_migration_landless_looters_apocalyptic }
					}
					add_character_flag = {
						flag = bm_cb_protect
						years = BARBARIAN_MIGRATION_CB_FOR_AI_PROTECT
					}
				}
			}
	
			# give temporary title
			scope:bi_looter = {
				# Randomising the names a little.
				create_dynamic_title = {
					tier = duchy
					name = LANDLESS_LOOTERS_TEMP_DUCHY_NAME
				}
				create_title_and_vassal_change = {
					type = created
					save_scope_as = change
					add_claim_on_loss = no
				}
				scope:new_title = {
					set_capital_county = scope:actor.capital_county
					set_landless_title = yes
					set_destroy_if_invalid_heir = yes
					set_destroy_on_gain_same_tier = yes
					set_delete_on_destroy = yes
					set_no_automatic_claims = yes
					set_definitive_form = yes
					set_can_be_named_after_dynasty = no
					change_title_holder = {
						holder = scope:bi_looter
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
				scope:new_title = {
					generate_coa = yes
					set_variable = {
						name = temporary_title
						value = yes
					}
				}
			}
			
			scope:recipient = {
				random_realm_county = {
					save_scope_as = target_title
				}
			}
			scope:bi_looter = {
				start_war = {
					cb = landless_looters_invasion
					target = scope:recipient
					target_title = scope:target_title
				}
			}
	
			# give troops
			scope:bi_looter = {
				spawn_army = {
					men_at_arms = {
						type = horse_archers
						stacks = LANDLESS_LOOTERS_CB_NUM_OF_horse_archers_DECLARATION
					}
					location = scope:actor.capital_county.title_province
					uses_supply = no
					inheritable = yes
					name = turkic_tribal_event_troops
				}
			}
		}
	}

	use_diplomatic_range = yes
	auto_accept = yes

	can_send_despite_rejection = no
	ai_frequency = 24
	ai_targets = {
		ai_recipients = neighboring_rulers
	}
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 0

		modifier = {
			add = 100
			scope:recipient = {
				has_relation_rival = scope:actor
			}
		}

		modifier = {
			factor = 0
			scope:recipient = {
				has_character_flag = incursion_ai_pacing
			}
		}

		modifier = {
			factor = 0
			scope:recipient = {
				is_at_war = yes
				is_ai = no
			}
		}

		modifier = {
			factor = 0
			scope:recipient = {
				is_ai = no
				is_liege_or_above_of = scope:actor
			}
		}

		modifier = {
			factor = 0
			scope:recipient = {
				OR = {
					has_relation_friend = scope:actor
					has_relation_lover = scope:actor
					opinion = {
						target = scope:actor
						value >= 45
					}
				}
			}
		}

		# 立地
		modifier = {
			add = 25
			scope:recipient.capital_county.title_province = {
				OR = {
					geographical_region = world_asia_minor
					geographical_region = world_middle_east_persia
					geographical_region = world_india_deccan
					geographical_region = world_india_bengal
					geographical_region = world_india_rajastan
				}
			}
		}

		# 異教徒
		modifier = {
			add = 25
			NOT = { scope:actor.faith = scope:recipient.faith }
		}

		# 開発度
		modifier = {
			add = 10
			scope:recipient.capital_county.development_level >= 15
		}
		modifier = {
			add = 10
			scope:recipient.capital_county.development_level >= 20
		}
		modifier = {
			add = 10
			scope:recipient.capital_county.development_level >= 30
		}
	}
}